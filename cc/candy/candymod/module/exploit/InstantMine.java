//Deobfuscated with https://github.com/SimplyProgrammer/Minecraft-Deobfuscator3000 using mappings "C:\Users\user\Desktop\1.12 stable mappings"!

//Decompiled by Procyon!

package cc.candy.candymod.module.exploit;

import cc.candy.candymod.module.*;
import cc.candy.candymod.setting.*;
import java.awt.*;
import net.minecraft.util.math.*;
import cc.candy.candymod.utils.*;
import cc.candy.candymod.*;
import net.minecraft.util.*;
import net.minecraft.init.*;
import net.minecraft.network.play.client.*;
import net.minecraft.network.*;
import cc.candy.candymod.event.events.network.*;
import cc.candy.candymod.event.events.world.*;
import net.minecraftforge.fml.common.eventhandler.*;
import net.minecraft.world.*;
import net.minecraft.block.state.*;
import net.minecraft.block.*;

public class InstantMine extends Module
{
    public Setting<Boolean> autoBreak;
    public Setting<Integer> delay;
    public Setting<Boolean> picOnly;
    public Setting<Boolean> render;
    public Setting<Color> color;
    public Setting<Boolean> line;
    public Setting<Float> width;
    private static boolean packetCancel;
    private static Timer breaktimer;
    private static Timer timer;
    private static EnumFacing direction;
    public static BlockPos FourZeroFourBlock;
    private static BlockPos lastBlock;
    
    public InstantMine() {
        super("InstantMine", Categories.EXPLOIT, false, false);
        this.autoBreak = (Setting<Boolean>)this.register(new Setting("AutoBreak", (T)true));
        this.delay = (Setting<Integer>)this.register(new Setting("Delay", (T)20, (T)500, (T)0));
        this.picOnly = (Setting<Boolean>)this.register(new Setting("Only Pickaxe", (T)true));
        final Setting register = this.register(new Setting("Render", (T)false));
        this.render = (Setting<Boolean>)register;
        this.render = (Setting<Boolean>)register;
        this.color = (Setting<Color>)this.register(new Setting("Color", (T)new Color(0, 0, 230, 90), v -> this.render.getValue()));
        this.line = (Setting<Boolean>)this.register(new Setting("Line", (T)false, v -> this.render.getValue()));
        this.width = (Setting<Float>)this.register(new Setting("Width", (T)2.0f, (T)5.0f, (T)0.2f, v -> this.render.getValue() && this.line.getValue()));
    }
    
    @Override
    public void onRender3D() {
        if (InstantMine.FourZeroFourBlock != null && this.render.getValue()) {
            if (this.line.getValue()) {
                RenderUtil3D.drawBoundingBox(InstantMine.FourZeroFourBlock, 1.0, this.width.getValue(), this.color.getValue());
            }
            else {
                RenderUtil3D.drawBox(InstantMine.FourZeroFourBlock, 1.0, this.color.getValue(), 63);
            }
        }
    }
    
    @Override
    public void onUpdate() {
        if (!CandyMod.m_module.getModuleWithClass((Class)SilentPickel.class).isEnable) {
            this.update();
        }
    }
    
    public void update() {
        if (this.nullCheck()) {
            return;
        }
        if (InstantMine.FourZeroFourBlock != null && this.autoBreak.getValue() && InstantMine.breaktimer.passedMs(this.delay.getValue())) {
            if (this.picOnly.getValue() && InstantMine.mc.player.getHeldItem(EnumHand.MAIN_HAND).getItem() != Items.DIAMOND_PICKAXE) {
                return;
            }
            InstantMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, InstantMine.FourZeroFourBlock, InstantMine.direction));
            InstantMine.breaktimer.reset();
        }
    }
    
    @Override
    public void onPacketSend(final PacketEvent.Send event) {
        if (this.nullCheck()) {
            return;
        }
        final Packet<?> packet = (Packet<?>)event.getPacket();
        if (packet instanceof CPacketPlayerDigging && ((CPacketPlayerDigging)packet).getAction() == CPacketPlayerDigging.Action.START_DESTROY_BLOCK && InstantMine.packetCancel) {
            event.cancel();
        }
    }
    
    @SubscribeEvent
    public void OnDamageBlock(final BlockEvent event) {
        if (this.nullCheck()) {
            return;
        }
        if (!this.isEnable) {
            return;
        }
        startBreak(event.pos, event.facing);
        event.cancel();
    }
    
    public static void startBreak(final BlockPos pos, final EnumFacing facing) {
        if (canBreak(pos)) {
            if (InstantMine.lastBlock == null || pos.getX() != InstantMine.lastBlock.getX() || pos.getY() != InstantMine.lastBlock.getY() || pos.getZ() != InstantMine.lastBlock.getZ()) {
                InstantMine.packetCancel = false;
                InstantMine.mc.player.swingArm(EnumHand.MAIN_HAND);
                InstantMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, pos, facing));
            }
            InstantMine.packetCancel = true;
            InstantMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, pos, facing));
            InstantMine.FourZeroFourBlock = pos;
            InstantMine.lastBlock = pos;
            InstantMine.direction = facing;
        }
    }
    
    private static boolean canBreak(final BlockPos pos) {
        final IBlockState blockState = InstantMine.mc.world.getBlockState(pos);
        final Block block = blockState.getBlock();
        return block.getBlockHardness(blockState, (World)InstantMine.mc.world, pos) != -1.0f;
    }
    
    static {
        InstantMine.packetCancel = false;
        InstantMine.breaktimer = new Timer();
        InstantMine.timer = new Timer();
    }
}
